Problem Statement:
Find the details of the employees who earn less than the average salary in their respective departments.

Note:
-Return the columns 'employee_id', 'first_name', 'last_name', 'department_id', and 'salary'.
-Return the output ordered by employee_id in ascending order.
-- An educational variation inspired by Scaler.

Solution : 

SELECT employee_id, first_name, last_name, department_id, salary
FROM 
(SELECT employee_id , first_name ,last_name , department_id , salary , 
    AVG(salary) OVER (PARTITION BY department_id) AS dep_sal
FROM employees ) x
WHERE salary < dep_sal
ORDER BY employee_id;

Alternate Way : 
SELECT e.employee_id, e.first_name,e.last_name, e.department_id, e.salary
FROM employees e
JOIN (
 SELECT department_id, AVG(salary) AS avg_salary
 FROM employees
 GROUP BY department_id
) AS dept_avg 
ON e.department_id = dept_avg.department_id
WHERE e.salary < dept_avg.avg_salary
ORDER BY employee_id;

Alternate Way : 

SELECT employee_id, first_name, last_name, department_id, salary
FROM employees e1
WHERE salary < (SELECT AVG(salary) 
FROM employees e2 
WHERE e2.department_id = e1.department_id)
ORDER BY employee_id;
